- name: Deploy application
  hosts: localhost
  gather_facts: false

  vars:
    ansible_host: "{{ lookup('env','ANSIBLE_HOST') }}"
    ansible_port: "{{ lookup('env','ANSIBLE_PORT') | int }}"
    ansible_user: "{{ lookup('env','ANSIBLE_USER') }}"
    ansible_ssh_pass: "{{ lookup('env','ANSIBLE_SSH_PASS') }}"
    ansible_connection: ssh
    ansible_python_interpreter: /usr/bin/python3

    plant: "{{ lookup('env','PLANT') }}"
    version: "{{ lookup('env','VERSION') }}"
    deploy_gui: "{{ lookup('env','DEPLOY_GUI') | default('true') | bool }}"

  tasks:
    - name: Deploy application version {{ version }} to plant {{ plant }} with GUI={{ deploy_gui }}
      ansible.builtin.shell: |
        echo "Deploying version {{ version }} to plant {{ plant }} with GUI={{ deploy_gui }}"
        echo "{{ version }}" > ~/{{ version }}
      register: deploy_result
    - debug:
        var: deploy_result.stdout